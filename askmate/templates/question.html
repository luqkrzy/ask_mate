{% extends "layout.html" %}
{% from '_macros.html' import macro_breadcrumbs, macro_submission_time, macro_image, macro_add_comment %}
{% block title %}Question{% endblock %}
{% block content %}
	<div class="container mt-3">
		<div class="row">
			<div class="row">
				<div class="col-lg-8 fs-5">{{ question.title }}&nbsp;
					<button type="button" class="btn-sm btn-primary">{{ func_find_tag_name(question.tag_id|int).tag_name|e }}</button>
				</div>
			</div>
			<div class="col-md-3 col-sm-2">
				{{ macro_image(data=question) }}
			</div>
			<div class="col-xxl">
				<div class="card-body">
					<p>{{ question.message }}</p>
					<hr>
					<div class="row mt-0">
						<div class="col-sm">
							<small class="text-muted">{{ macro_submission_time(data=question) }}</small>
						</div>
						<div class="col-sm">
							<small class="text-muted">score: {{ question.vote_number }} votes</small>
						</div>
						<div class="col-sm mb-2">
							<small class="text-muted">views: {{ question.view_number }} </small>
						</div>
						<div class="col-sm mb-2">
							<a href="{{ url_for('questions.route_question', question_id=question.question_id, questions_votes=+1) }}"><i class="far fa-thumbs-up btn btn-outline-success"></i></a>&nbsp;&nbsp;
							<a href="{{ url_for('questions.route_question', question_id=question.question_id, questions_votes=-1) }}"><i class="far fa-thumbs-down btn btn-outline-danger"></i></a>
						</div>
						{% if current_user.user_id == question.user_id %}
							<div class="col-sm text-end">
								<a href="{{ url_for('questions.route_edit_question', question_id=question.question_id) }}">
									<button type="button" class="btn btn-outline-primary btn-sm">edit</button>
								</a>
								<button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#confirm_delete_question">
									delete
								</button>
							</div>
						{% endif %}
						{% if comments_for_question %}
							<div class="container mt-3">
								<p>
									<button class="btn-sm btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_comment" aria-expanded="false" aria-controls="collapse_comment">
										comments&nbsp;<span class="badge bg-secondary">{{ comments_for_question.count() }}</span>
									</button>
								</p>
								<div class="collapse" id="collapse_comment">
									<div class="card card-body">
										<table class="table">
											<tbody>
											{% for comment in comments_for_question %}
												<tr>
													<td>{{ comment.message }}</td>
													<td>
														<small class="text-muted"><a class="text-decoration-none" href="#">nickname</a></small>
													</td>
												</tr>
											{% endfor %}
											</tbody>
										</table>
										<br>{{ macro_add_comment(action=url_for('questions.route_add_comment_for_question', question_id=question.question_id), comment_for="comments_for_question") }}
									</div>
								</div>
							</div>
						{% else %}
							<br><br>
							{{ add_comment(action=url_for('questions.route_add_comment_for_question', question_id=question.id), comment_for="comments_for_question") }}
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>
	{#	Modal confirm delete question #}
	<div class="modal fade" id="confirm_delete_question" tabindex="-1" aria-labelledby="confirm_deleteLabel" aria-hidden="true">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="confirm_deleteLabel">Confirm delete</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<a href="{{ url_for('questions.route_question', question_id=question.question_id, remove_question=True) }}">
						<button type="button" class="btn btn-danger btn-sm">delete</button>
					</a>
					<button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">close</button>
				</div>
			</div>
		</div>
	</div>


{% endblock %}
